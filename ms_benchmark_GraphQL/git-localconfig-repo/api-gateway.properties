# API Gateway Configuration

# Server Configuration
server.port=8765

# JWT Configuration
# Bu secret authentication service ile AYNI olmalı!
app.jwt.secret=${JWT_SECRET:your-256-bit-secret-key-change-this-in-production-make-it-very-long-and-secure}
app.jwt.issuer=netflix-clone-auth
app.jwt.audience=netflix-clone-users

# Public Endpoints (Authentication gerektirmeyen endpoint'ler)
# Virgülle ayrılmış liste
# NOT: Hem prefix'li (/authentication/...) hem prefix'siz (/api/auth/...) path'ler eklenmelidir
# çünkü stripPrefix işlemi filter'lardan önce/sonra farklı zamanlarda uygulanabilir
gateway.public-paths=/api/auth/register,\
  /api/auth/login,\
  /api/auth/google-login,\
  /api/auth/google/login,\
  /api/subscription/plans,\
  /api/subscription/health,\
  /api/profiles/health,\
  /api/users/health,\
  /api/contents/health,\
  /api/stream/health,\
  /actuator/health,\
  /actuator/info,\
  /api/users/analytics/dashboard,\
  /graphql

# Gateway Discovery Configuration
spring.cloud.gateway.discovery.locator.enabled=false
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# CORS Configuration for Cross-Origin Requests
# Fiziksel sunucu IP'lerinden gelen istekleri kabul et
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origin-patterns=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].exposed-headers=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allow-credentials=false
spring.cloud.gateway.globalcors.cors-configurations.[/**].max-age=3600

# Logging Configuration
logging.level.com.microservices.api_gateway=INFO
logging.level.org.springframework.cloud.gateway=INFO
logging.level.reactor.netty.http.client=WARN

# Actuator Configuration
management.endpoints.web.exposure.include=health,info,gateway
management.endpoint.health.show-details=always
management.endpoint.gateway.enabled=true

# ROTALAR (ROUTES)

# 1. User Service
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=http://user-service-1:9000
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/users/**
spring.cloud.gateway.routes[0].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 2. Authentication Service
spring.cloud.gateway.routes[1].id=authentication-service
spring.cloud.gateway.routes[1].uri=http://authentication-service:8000
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.routes[1].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 3. Subscription and Billing Service
spring.cloud.gateway.routes[2].id=subscription-and-billing-service
spring.cloud.gateway.routes[2].uri=http://subscription-and-billing-service:9100
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/subscription/**
spring.cloud.gateway.routes[2].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 4. Profile Service
spring.cloud.gateway.routes[3].id=profile-service
spring.cloud.gateway.routes[3].uri=http://profile-service:9001
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/profiles/**
spring.cloud.gateway.routes[3].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 5. Content Management Service
spring.cloud.gateway.routes[4].id=content-management-service
spring.cloud.gateway.routes[4].uri=http://content-management-service:9200
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/contents/**
spring.cloud.gateway.routes[4].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 6. Video Streaming Service
spring.cloud.gateway.routes[5].id=video-streaming-service
spring.cloud.gateway.routes[5].uri=http://video-streaming-service:9300
# Hem API hem de video path'lerini yakalar (örnek: /api/stream/video/123 veya /videos/test.mp4)
# Not: Video streaming servisi /api/stream altında çalışıyor varsayılmıştır.
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/stream/**
spring.cloud.gateway.routes[5].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 7. Payment Service (Subscription Service içinde)
spring.cloud.gateway.routes[6].id=payment-service
spring.cloud.gateway.routes[6].uri=http://subscription-and-billing-service:9100
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/payment/**
spring.cloud.gateway.routes[6].filters[0]=AddRequestHeader=X-Gateway-Request, true

# 8. GraphQL Federation Gateway
spring.cloud.gateway.routes[7].id=graphql-gateway
spring.cloud.gateway.routes[7].uri=http://graphql-gateway:4000
spring.cloud.gateway.routes[7].predicates[0]=Path=/graphql,/graphql/**
spring.cloud.gateway.routes[7].filters[0]=AddRequestHeader=X-Gateway-Request, true

